<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Paste To Shape</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    textarea { width: 100%; height: 200px; }
    canvas { border: 1px solid #444; margin-top: 20px; width: 100%; max-width: 600px; }
    button { padding: 10px 20px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Paste To Shape</h1>
  <p>生データをここに貼って「描画」ボタンを押すだけで図形化できます。</p>

  <textarea id="rawInput" placeholder="ここにデータを貼り付け"></textarea>
  <br />
  <button onclick="drawShape()">描画</button>

  <canvas id="shapeCanvas" width="800" height="800"></canvas>

  <script>
    function drawShape() {
      const raw = document.getElementById("rawInput").value;
      const canvas = document.getElementById("shapeCanvas");
      const ctx = canvas.getContext("2d");

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.lineWidth = 2;

      // BZ1,xxxx,yyyy,... を拾う
      const regex = /BZ1,([-0-9,]+)/g;
      let match;
      let lines = [];

      while ((match = regex.exec(raw)) !== null) {
        const nums = match[1].split(",").map(Number);
        const pts = [];
        for (let i = 0; i < nums.length; i += 2) {
          pts.push({ x: nums[i], y: nums[i + 1] });
        }
        lines.push(pts);
      }

      if (lines.length === 0) {
        alert("BZ1 の座標データが見つかりませんでした。");
        return;
      }

      // 座標の最大・最小を求めてスケール調整
      let allX = [], allY = [];
      lines.forEach(line => line.forEach(p => { allX.push(p.x); allY.push(p.y); }));
      const minX = Math.min(...allX), maxX = Math.max(...allX);
      const minY = Math.min(...allY), maxY = Math.max(...allY);

      const w = canvas.width - 40;
      const h = canvas.height - 40;
      const scaleX = w / (maxX - minX);
      const scaleY = h / (maxY - minY);
      const scale = Math.min(scaleX, scaleY);

      ctx.strokeStyle = "black";

<script>
function drawShape() {
  console.log("描画開始"); // ← 動作確認用

  // canvas や ctx がここより前で定義されてる前提
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // 描画
  lines.forEach(pts => {
    ctx.beginPath();
    pts.forEach((p, i) => {
      const x = 20 + (p.x - minX) * scale;
      const y = 20 + (maxY - p.y) * scale; // Y反転
      if (i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    });
    ctx.stroke();
  });
}
</script>
